% swjtu.sty – 西南交通大学本科毕业论文样式
% 版本：2022年修订版
% 作者：abwuge
% 修改日期：2025年4月25日
\ProvidesPackage{style/swjtu}[SWJTU Thesis Style]

%%% ======================== 版面 ======================== %%%
\RequirePackage{geometry}
\geometry{
  paper=a4paper,
  left=2.7cm, right=2.7cm,
  top=2.6cm, bottom=2.6cm
}

%%% ======================= 页眉页脚 ======================= %%%
\RequirePackage{fancyhdr}
\pagestyle{fancy}

\fancyhead[C]{\zihao{-4}\heiti 西南交通大学本科毕业设计(论文)}
\renewcommand{\headrulewidth}{0.8pt}

\fancyfoot[C]{第\zihao{-4}\heiti\thepage 页}
\renewcommand{\footrulewidth}{0pt}

%%% ======================== 字体 ======================== %%%
\setmainfont{Times New Roman}
\setCJKmainfont[Path=fonts/]{simsun.ttc}

\setCJKfamilyfont{songti}[Path=fonts/, AutoFakeBold=2.5]{simsun.ttc}
\newcommand{\songti}{\CJKfamily{songti}}

\setCJKfamilyfont{heiti}[Path=fonts/, AutoFakeBold=2.5]{simhei.ttf}
\newcommand{\heiti}{\CJKfamily{heiti}}

\newfontfamily{\ensongti}[Path=fonts/, AutoFakeBold=2.5]{simsun.ttc}
\newfontfamily{\enheiti}[Path=fonts/, AutoFakeBold=2.5]{simhei.ttf}

\RequirePackage{environ}

% 黑体环境
\NewEnviron{allheiti}{%
  {\heiti\enheiti\BODY}%
}

% 宋体环境
\NewEnviron{allsongti}{%
  {\songti\ensongti\BODY}%
}

%%% ======================== 杂项 ======================== %%%
\RequirePackage{xkeyval}    % key-value
\usepackage{setspace}       % 行距
\usepackage{graphicx}       % 插入图片
\usepackage{amssymb}        % 数学符号
\setlength{\parindent}{2em} % 段首缩进

%%% ======================== 扉页 ======================== %%%
\makeatletter
\define@key[swjtu]{titlepage}{ctitle}{\def\swjtu@ctitle{#1}}
\define@key[swjtu]{titlepage}{etitle}{\def\swjtu@etitle{#1}}
\define@key[swjtu]{titlepage}{grade}{\def\swjtu@grade{#1}}
\define@key[swjtu]{titlepage}{id}{\def\swjtu@id{#1}}
\define@key[swjtu]{titlepage}{name}{\def\swjtu@name{#1}}
\define@key[swjtu]{titlepage}{major}{\def\swjtu@major{#1}}
\define@key[swjtu]{titlepage}{advisor}{\def\swjtu@advisor{#1}}
\define@key[swjtu]{titlepage}{year}{\def\swjtu@year{#1}}
\define@key[swjtu]{titlepage}{month}{\def\swjtu@month{#1}}

\newcommand{\swjtuTitlePage}[1][]{%
  \def\swjtu@ctitle{}
  \def\swjtu@etitle{}
  \def\swjtu@grade{}
  \def\swjtu@id{}
  \def\swjtu@name{}
  \def\swjtu@major{}
  \def\swjtu@advisor{}
  \def\swjtu@year{}
  \def\swjtu@month{}
  \setkeys[swjtu]{titlepage}{#1}

  \begin{titlepage}
    \onehalfspacing \zihao{5} \songti

    \begin{center}
      % 空行 * 3
      ~\\ \vspace{2\baselineskip}

      % 标题
      \begin{allheiti} \doublespacing \zihao{-2}
        西\hspace{0.5em}南\hspace{0.5em}交\hspace{0.5em}通\hspace{0.5em}大\hspace{0.5em}学\strut\\
        本科毕业设计（论文）
      \end{allheiti}

      % 空行 * 3
      \vspace{3\baselineskip}

      % 中英文题目
      \begin{allheiti} \singlespacing \zihao{2}
        \swjtu@ctitle\strut\\
        \MakeUppercase{\swjtu@etitle}
      \end{allheiti}

      % 空行 * 7
      \vspace{7\baselineskip}

      % 个人信息
      \begin{allheiti} \zihao{-4}
        \begin{tabular}{l}
          年\hspace{2em}级:~\swjtu@grade \\
          学\hspace{2em}号:~\swjtu@id    \\
          姓\hspace{2em}名:~\swjtu@name  \\
          专\hspace{2em}业:~\swjtu@major \\
          指导老师:~\swjtu@advisor
        \end{tabular}
      \end{allheiti}

      % 空行 * 13
      \vspace{13\baselineskip}

      % 日期
      \begin{allsongti} \zihao{-4}
        \swjtu@year\:年\:\swjtu@month\:月
      \end{allsongti}
    \end{center}
  \end{titlepage}

  % 空白页
  \newpage
  \thispagestyle{empty}
  \mbox{}
}
\makeatother

%%% ====================== 学术诚信声明 ====================== %%%
\makeatletter
\define@key[swjtu]{integrity}{signature}{\def\swjtu@signature{#1}}
\define@key[swjtu]{integrity}{year}{\def\swjtu@year{#1}}
\define@key[swjtu]{integrity}{month}{\def\swjtu@month{#1}}
\define@key[swjtu]{integrity}{day}{\def\swjtu@day{#1}}

\newcommand{\swjtuIntegrityDeclaration}[1][]{%
  \def\swjtu@signature{}
  \def\swjtu@year{}
  \def\swjtu@month{}
  \def\swjtu@day{}
  \setkeys[swjtu]{integrity}{#1}

  \begin{titlepage}
    \doublespacing \zihao{4} \songti

    % 标题
    \begin{center}
      \begin{allheiti} \onehalfspacing \zihao{-2}
        \textbf{西南交通大学}\strut\\
        \textbf{本科毕业设计（论文）学术诚信声明}
      \end{allheiti}
    \end{center}

    % 空行
    \vspace{\baselineskip}

    % 正文
    本人郑重声明：所呈交的毕业设计（论文），是本人在导师的指导下，独立进行研究工作所取得的成果。除文中已经注明引用的内容外，本论文不包含任何其他个人或集体已经发表或撰写过的作品成果。对本文的研究做出重要贡献的个人和集体，均已在文中以明确方式标明。本人完全意识到本声明的法律结果由本人承担。

    % 空行 * 3
    \vspace{3\baselineskip}

    % 签名
    {\noindent \hspace*{0.5\textwidth}
      作者签名：%
      \ifx\swjtu@signature\@empty\else
        \raisebox{-0.5\baselineskip}{\includegraphics[height=1.5\baselineskip]{\swjtu@signature}}
      \fi
    }

    % 空行
    \vspace{\baselineskip}

    % 日期
    \begin{allsongti} \zihao{4}
      \noindent \hspace*{0.5\textwidth}
      日期：\swjtu@year~年~\swjtu@month~月~\swjtu@day~日
    \end{allsongti}
  \end{titlepage}
}
\makeatother

%%% ====================== 版权使用授权 ====================== %%%
% 方框带勾符号
\newcommand{\boxsurd}{\rlap{$\Box$}{\raisebox{0.1ex}{\hspace{-0.1em}$\surd$}}}

\makeatletter
\define@key[swjtu]{copyright}{confidentialityPeriod}{\def\swjtu@confidentialityPeriod{#1}}
\define@key[swjtu]{copyright}{authorSignature}{\def\swjtu@authorSignature{#1}}
\define@key[swjtu]{copyright}{advisorSignature}{\def\swjtu@advisorSignature{#1}}
\define@key[swjtu]{copyright}{authorYear}{\def\swjtu@authorYear{#1}}
\define@key[swjtu]{copyright}{authorMonth}{\def\swjtu@authorMonth{#1}}
\define@key[swjtu]{copyright}{authorDay}{\def\swjtu@authorDay{#1}}
\define@key[swjtu]{copyright}{advisorYear}{\def\swjtu@advisorYear{#1}}
\define@key[swjtu]{copyright}{advisorMonth}{\def\swjtu@advisorMonth{#1}}
\define@key[swjtu]{copyright}{advisorDay}{\def\swjtu@advisorDay{#1}}

\newcommand{\swjtuCopyrightAuthorization}[1][]{%
  \def\swjtu@confidentialityPeriod{0}
  \def\swjtu@authorSignature{}
  \def\swjtu@advisorSignature{}
  \def\swjtu@authorYear{}
  \def\swjtu@authorMonth{}
  \def\swjtu@authorDay{}
  \def\swjtu@advisorYear{}
  \def\swjtu@advisorMonth{}
  \def\swjtu@advisorDay{}
  \setkeys[swjtu]{copyright}{#1}

  \begin{titlepage}
    \doublespacing \zihao{4} \songti

    % 标题
    \begin{center}
      \begin{allheiti} \onehalfspacing \zihao{-2}
        \textbf{西南交通大学}\strut\\
        \textbf{本科毕业设计（论文）版权使用授权书}
      \end{allheiti}
    \end{center}

    % 空行
    \vspace{\baselineskip}

    \begin{allsongti} \zihao{4}
      % 正文
      本毕业设计（论文）作者同意学校保留并向国家有关部门或机构送交论文的复印件和电子版，允许论文被查阅和借阅。本人授权西南交通大学可以将本毕业设计（论文）的全部或部分内容编入有关数据库进行检索，可以采用影印、缩印或扫描等复制手段保存和汇编本毕业设计（论文）。

      % 保密/不保密自动判断，勾选用\boxsurd，未选用\Box，分段显示
      \ifnum\swjtu@confidentialityPeriod>0
        \hspace{7em}保密$\boxsurd$，在~\underline{\hspace{0.5em}\swjtu@confidentialityPeriod\hspace{0.5em}}~年解密后适用本授权书。
        \par
        本论文属于
        \par
        \hspace{7em}不保密$\Box$。
      \else
        \hspace{7em}保密$\Box$，在~\underline{\hspace{2em}}~年解密后适用本授权书。
        \par
        本论文属于
        \par
        \hspace{7em}不保密$\boxsurd$。
      \fi

      （请在以上方框内打“$\surd$”）
    \end{allsongti}

    % 空行 * 3
    \vspace{3\baselineskip}

    % 签名与日期
    {
      \noindent
      \begin{minipage}{0.48\textwidth}
        作者签名：%
        \ifx\swjtu@authorSignature\@empty\else
          \raisebox{-0.5\baselineskip}{
            \includegraphics[height=1.5\baselineskip]{\swjtu@authorSignature}
          }
        \fi

        \vspace{\baselineskip}

        日期：~\swjtu@authorYear~年~\swjtu@authorMonth~月~\swjtu@authorDay~日
      \end{minipage}
      \hfill
      \begin{minipage}{0.48\textwidth}
        指导教师签名：%
        \ifx\swjtu@advisorSignature\@empty\else
          \raisebox{-0.5\baselineskip}{
            \includegraphics[height=1.5\baselineskip]{\swjtu@advisorSignature}
          }
        \fi

        \vspace{\baselineskip}

        日期：~\swjtu@advisorYear~年~\swjtu@advisorMonth~月~\swjtu@advisorDay~日
      \end{minipage}
    }

  \end{titlepage}
}
\makeatother

% ================== 任务 ==================
\makeatletter
\define@key[swjtu]{task}{text}{\def\swjtu@task{#1}}
\newcommand{\swjtuTask}[1][]{%
  \def\swjtu@task{}
  \setkeys[swjtu]{task}{#1}
  \chapter*{任务书}
  \noindent
  \swjtu@task
}
\makeatother

% ================== 中文摘要命令（key-value 方式） ==================
\makeatletter
\define@key[swjtu]{abstractcn}{text}{\def\swjtu@abstractcn{#1}}
\define@key[swjtu]{abstractcn}{keywords}{\def\swjtu@keywordsCN{#1}}
\newcommand{\swjtuAbstractCNCmd}[1][]{%
  \def\swjtu@abstractcn{}
  \def\swjtu@keywordsCN{}
  \setkeys[swjtu]{abstractcn}{#1}
  \chapter*{中文摘要}
  \noindent
  \swjtu@abstractcn
  \\
  \textbf{关键词：}\swjtu@keywordsCN
}
\makeatother

% ================== 英文摘要命令（key-value 方式） ==================
\makeatletter
\define@key[swjtu]{abstracten}{text}{\def\swjtu@abstracten{#1}}
\define@key[swjtu]{abstracten}{keywords}{\def\swjtu@keywordsEN{#1}}
\newcommand{\swjtuAbstractENCmd}[1][]{%
  \def\swjtu@abstracten{}
  \def\swjtu@keywordsEN{}
  \setkeys[swjtu]{abstracten}{#1}
  \chapter*{Abstract}
  \noindent
  \swjtu@abstracten
  \\
  \textbf{Keywords:} \swjtu@keywordsEN
}
\makeatother



% 后续可添加自定义命令和格式设置
